<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Layout</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">

    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">
</head>

<body>
    <div id="app">
        <div id="sidebar" class="active">
            <div class="sidebar-wrapper active">
              <div class="sidebar-header py-0">
                <div class="d-flex justify-content-center">
                        <div class="logo">
                            <a href="index.html"><img style="height: 100px;" src="https://png.pngtree.com/element_our/png/20180911/background-material-design-for-lorem-ipsum-logo-png_89715.jpg" alt="Logo" srcset=""></a>
                        </div>
                        <div class="toggler">
                            <a href="#" class="sidebar-hide d-xl-none d-block"><i class="bi bi-x bi-middle"></i></a>
                        </div>
                    </div>
                </div>
                <div class="sidebar-menu">
                    <ul class="menu">
                        <li class="sidebar-title">Menu</li>

                        <li class="sidebar-item  ">
                            <a href="index.html" class='sidebar-link'>
                                <i class="bi bi-grid-fill"></i>
                                <span>Dashboard</span>
                            </a>
                        </li>

                        <li class="sidebar-item active ">
                            <a href="form-layout.html" class='sidebar-link'>
                                <i class="bi bi-file-earmark-medical-fill"></i>
                                <span>Form Layout</span>
                            </a>
                        </li>

                       
                        <li class="sidebar-item  ">
                            <a href="table-datatable.html" class='sidebar-link'>
                                <i class="bi bi-file-earmark-spreadsheet-fill"></i>
                                <span>Datatable</span>
                            </a>
                        </li>

                        <li class="sidebar-item  ">
                            <a href="notes.html" class='sidebar-link'>
                                <i class="bi bi-file-earmark-spreadsheet-fill"></i>
                                <span>Notes</span>
                            </a>
                        </li>

                    </ul>
                </div>
                <button class="sidebar-toggler btn x"><i data-feather="x"></i></button>
            </div>
        </div>
        <div id="main">
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>

              
                <section id="multiple-column-form">
                    <div class="row match-height">
                        <div class="col-12">
                            <div class="card">
                                <!-- <div class="card-header">
                                    <h4 class="card-title">Campaign Form</h4>
                                </div> -->
                                <div class="card-content">
                                    <div class="card-body">
                                        <form class="form">
                                            <div class="row">
                                                
                                                    <div class="col-md-6 col-12">
                                                        <div class="form-group">
                                                            <label for="campaign-name-column">Campaign Name</label>
                                                            <input type="text" id="campaign-name-column" class="form-control"
                                                                placeholder="Campaign Name" name="fname-column" required>
                                                                <p id="campaignErr" style="color: red; display: none;">Campaign already exist</p>
                                                        </div>
                                                    </div>


                                                <div class="col-md-6 col-12">
                                                    <div class="form-group">
                                                        <label for="campaign-id-column">Campaign ID</label>
                                                        <input type="text" id="campaign-id-column" class="form-control"
                                                            placeholder="Campaign ID" name="lname-column" >
                                                    </div>
                                                </div>

                                                
                                                <div class="col-md-3 col-12">
                                                  <div class="form-group">
                                                      <label for="client-code-select">Client Code</label>
                                                      <fieldset class="form-group">
                                                      <select class="form-select" id="client-code-select" style="width: 210px;">
                                                        <option value="CS">CS</option>
                                                        <option value="Survey">Survey</option>
                                                        <option value="eBlast">eBlast</option>
                                                    </select>
                                                  </fieldset>
                                                  </div>
                                              </div>

                                                <div class="col-md-3 col-12">
                                                  <div class="form-group">
                                                      <label for="category-select">Category</label>

                                                      
                                                      
                                                      <fieldset class="form-group ">
                                                      <select class="form-select" id="category-select" style="width: 210px;" required>
                                                        <option  value="">Select</option>
                                                        <!-- CS options -->
                                                        
                                                        <option class="csOptions" value="TGIF (email marketing)">TGIF (email marketing)</option>
                                                        <option class="csOptions" value="ALPHA (ACE)">ALPHA (ACE)</option>
                                                        <option class="csOptions" value="VIBE">VIBE</option>
                                                        <option class="csOptions" value="IP">IP</option>
                                                        <option class="csOptions" value="TAJ (ARC)">TAJ (ARC)</option>
                                                        <option class="csOptions" value="RAY (INSTA)">RAY (INSTA)</option>
                                                        <option class="csOptions" value="MTH">MTH</option>
                                                        <option class="csOptions" value="PHANTOM (Magento)">PHANTOM (Magento)</option>
                                                        <option class="csOptions" value="W8 (CS)">W8 (CS)</option>
                                                        <option class="csOptions" value="CIVIC">CIVIC</option>
                                                        <option class="csOptions" value="EAGLE">EAGLE</option>

                                                      <!-- Survey options -->
                                                   
                                                        <option class="surveyOptions" value="PKT">PKT</option>
                                                        <option class="surveyOptions" value="API">API</option>
                                                        <option class="surveyOptions" value="W8-RB">W8-RB</option>
                                                        <option class="surveyOptions" value="W8-LE">W8-LE</option>
                                                        <option class="surveyOptions" value="W8-LA">W8-LA</option>
                                                        <option class="surveyOptions" value="W8-Techscore">W8-Techscore</option>
                                                        <option class="surveyOptions" value="ITBP-Techscore">ITBP-Techscore</option>
                                                        <option class="surveyOptions" value="MTH API">MTH API</option>
                                                        <option class="surveyOptions" value="ITBP PKT (.NET)">ITBP PKT (.NET)</option>
                                                        <option class="surveyOptions" value="Email ijp">Email IJP</option>
                                                 

                                                    <!-- E Blast options -->
                                                   
                                                        <option class="eblastOptions" value="ACE eblast">ACE eblast</option>
                                                    <option class="eblastOptions" value="W8 eblast">W8 eblast</option>
                                                    
                                                    </select>
                                                  </fieldset>

                                                
                                                  </div>
                                              </div>
                                      
                                                <div class="col-md-3 col-12">
                                                    <div class="form-group">
                                                        <label for="country-floating">Country</label>
                                                        <fieldset class="form-group">
                                                          <select class="form-select" id="country-select"  style="width: 210px;">
                                                            <option value="EU">EU</option>
                                                            <option value="NON-EU">NON-EU</option>
                                                            <option value="Both">Both</option>
                                                        </select>
                                                      </fieldset>
                                                    </div>
                                                </div>

                                                <!-- <div class="col-md-6 col-12">
                                                    <div class="form-group">
                                                        <label for="company-column">Company</label>
                                                        <input type="text" id="company-column" class="form-control"
                                                            name="company-column" placeholder="Company" required>
                                                    </div>
                                                </div> -->


                                                <!-- <div class="col-md-6 col-12">
                                                    <div class="form-group">
                                                        <label for="made-by-column">Made by</label>
                                                        <input type="text" id="made-by-column" class="form-control"
                                                            name="made-by-column" placeholder="Made by" required>
                                                    </div>
                                                </div>
                                                 -->

                                                <div class="card-body">
                                                    <div class="form-group mb-3">
                                                        <label for="asset-link-data" class="form-label">
                                                        Paste Excel Table Here    
                                                        </label>
                                                        <textarea class="form-control" id="asset-link-data"
                                                            rows="5" required></textarea>
                                                    </div>
                                                                                                    
                                                    <div class="form-group mb-3">
                                                        <label for="comment" class="form-label">
                                                        Comment    
                                                        </label>
                                                        <textarea class="form-control" placeholder="If Any" id="comment"
                                                            rows="2"></textarea>
                                                    </div>
                                                </div>

                                                <!-- To Show Asset name and links in table form, if want remove style-->
                                                <div id="output"  style="height: 0px; overflow: hidden;"  >
                                                    <table id="excelDataTable"></table>
                                                  </div>
                                                  <!-- ******************************* -->

                                                <div class="col-12 d-flex justify-content-end">
                                                    <button id="submitBtn" type="submit"
                                                        class="btn btn-primary me-1 mb-1">Submit</button>
                                                    <button type="reset"
                                                        class="btn btn-light-secondary me-1 mb-1" id="resetBtn">Reset</button>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

              </div>

            <footer>
             
            </footer>
        </div>
    </div>
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>

    <script src="assets/js/main.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>

    <script src="./assets/js/extensions/sweetalert2.js"></script>
    <script src="./assets/vendors/sweetalert2/sweetalert2.all.min.js"></script>
  <script>
var userDetails;
         try{
           userDetails = atob(document.cookie.split('.')[1]);
          userDetails = JSON.parse(userDetails)
       }catch{
        swal.fire({
                                title: "Error",
                                text: "Please Login",
                                icon: "error",
                                confirmButtonText: "Ok"
                            }).then(()=>{
                              window.location = "http://localhost/frontend/dist/auth-login.html";

                            })
       }
    // ************************** below code change category acording to client code **********************
    function changeCategory() {
        if ($("#client-code-select").val()=='Survey') {
        $(".csOptions").css("display", "none");
        $(".eblastOptions").css("display", "none");                                         
        $(".surveyOptions").css("display", "inline-block");
      }else if($("#client-code-select").val()=='CS'){
        $(".csOptions").css("display", "inline-block");
        $(".surveyOptions").css("display", "none");     
        $(".eblastOptions").css("display", "none");                                                                             
      }else{
        $(".csOptions").css("display", "none");
        $(".surveyOptions").css("display", "none");                                         
        $(".eblastOptions").css("display", "inline-block");                                         

      }
    }changeCategory();
    $("#client-code-select").change(function(){
        changeCategory();
});
$("#resetBtn").click(function(){
        $(".csOptions").css("display", "inline-block");
        $(".surveyOptions").css("display", "none");      
        $(".eblastOptions").css("display", "none");                                         
                                   
});
$("#category-select").change(function(){
console.log($('#category-select').val());
});

// ********************* below code to convert table to JSON ****************

const replaceLineBreaksBetweenDoubleQuotes=(inputValue)=>{
            return inputValue.replace(/"[^"]*(?:""[^"]*)*"/g, function(m) { return m.replace(/\n/g, ''); })
        }

        const removeDoubleQuotes=(inputValue)=>{
            return inputValue.replace(/"/g, "")
        }

        const splitLineHavingTabspaceAndMakeJsonObject=(line)=>{
            var arr = line.split('\t');
            return {title:arr[0],link:arr[1]}
        }
        
        const loopThroughEachLine=(inputValue)=>{
            inputValue=replaceLineBreaksBetweenDoubleQuotes(inputValue);

            var lines = inputValue.split('\n').filter((n) => n.length > 0);
            var linksArray=[]
            for(var i = 0;i < lines.length;i++){

                const line=removeDoubleQuotes(lines[i]);
                const linkObject=splitLineHavingTabspaceAndMakeJsonObject(line)
                linksArray.push(linkObject);

            }
            return linksArray;
        }

   
let assetLinkJson;
$(document).ready(function(){
            $("#asset-link-data").on("input",function(e){
                var inputValue=$(e.target).val();
                inputValue=loopThroughEachLine(inputValue);
                  
                 assetLinkJson=inputValue;
                 console.log(assetLinkJson);    
            });
        });
              
// *************************** Check if campaign exist *************************************   
                        $('#campaign-name-column').on('input', function(e) {
                            e.preventDefault();
                            let cnameAddDash = $("#campaign-name-column").val();
                      cnameAddDash = cnameAddDash.replaceAll(' ', '-');
                      cnameAddDash = cnameAddDash.replaceAll('_', '-');
                      let tempr=true;
                      while(tempr){
                      
                        if (cnameAddDash.includes('--')) {
                            cnameAddDash = cnameAddDash.replaceAll('--', '-'); 
                        }
                        else{
                            tempr=false;
                        }
                      }
                      $('#campaign-name-column').val(cnameAddDash);

                      $.ajax({
                      type: "POST",
                      url: "http://localhost:1010/check/check-camp",
                      data: JSON.stringify({Campaign_Name:cnameAddDash}),
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      encode: true,
                    }).done(function (data) {
                    
                      if(data.length==0){
                        
                        $('#campaign-name-column').css('border', '1px solid green');
                        $('#campaignErr').css('display', 'none');
                        $('#submitBtn').removeAttr('disabled');
                      }else{
                        $('#campaign-name-column').css('border', '1px solid red');
                        $('#campaignErr').css('display', 'block');
                        $('#submitBtn').attr('disabled', 'disabled');
                     
                      }
                    
                        });
                    });
              // *************************** After Submit function *************************************
                  $(document).ready(function () {
                  $("form").submit(function (event) {
                    event.preventDefault();
                      
                    var formData = {
                      cname: $("#campaign-name-column").val(),
                      cid: $("#campaign-id-column").val(),
                      category: $("#category-select").val(),
                      client_code: $("#client-code-select").val(),
                      country: $("#country-select").val(),
                      asset_link_data: assetLinkJson,
                      comment: $("#comment").val(),
                      username:userDetails.firstname,
                      userid:userDetails.username
                    };
                                              
                    $.ajax({
                      type: "POST",
                      url: "http://localhost:1010/app/v1/form-data",
                      data: JSON.stringify(formData),
                      dataType: "json",
                      contentType: "application/json; charset=utf-8",
                      encode: true,
                    }).done(function (data) {
                    
                      $("#resetBtn").click();
                      swal.fire({
                                title: "Data Added Successfully",
                               
                                icon: "success",
                                confirmButtonText: "Ok",
                            })
                    });
                  });
                });
       // ***********************************************************************
    </script>


</body>

</html>